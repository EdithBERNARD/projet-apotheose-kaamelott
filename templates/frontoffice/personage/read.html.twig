{% extends 'base.html.twig' %}

{% block title %}Kaamel'O'tt - {{ personage.name }}{% endblock %}

{% block body %}

<main class="main">

    <h2 class="main__item">{{ personage.name }}</h2>

    <div class="row mb-lg-4 justify-content-center">
        
        <div class="col-lg-4">

            <div class="text-center mb-lg-3 main__item--img">
            {% if personage.picture %}
                <img src="{{ asset('img/personage/' ~ personage.picture ) }}" alt="{{ personage.name }}" class="img-fluid" title="Crédits : {{ personage.descriptionPicture }}">
            {% else %}
                <img src="{{ asset('img/icone.png')}}" alt="- pas de photo de disponible pour le moment -" class="img-fluid">
                <br>- pas de photo de disponible pour le moment -
            {% endif %}
            </div>

            <h6 class="main__item">Est joué par: {{ personage.actor.name }}</h6>

            <div class="text-center">
            {% if personage.actor.picture %}
                <img src="{{ asset('img/actor/' ~ personage.actor.picture ) }}" alt="{{ personage.actor.name }}" class="img-fluid" title="Crédits : {{ personage.descriptionPicture }}">
            {% else %}
                <img src="{{ asset('img/icone.png')}}" alt="- pas de photo de disponible pour le moment -" class="img-fluid">
                <br>- pas de photo de disponible pour le moment -
            {% endif %}
            </div>
            

        </div>
        
        
        <div class="col-lg-8">
            <div class="col">

                <p class="main__item main__item--text mb-lg-3">{{ personage.description }}</p>


                <h6 class="main__item">Ses citations :</h6>

                {# {% for quote in character.quotes %} #}
                {% for quote in pagination %}

                {# {% include 'partials/_card_quote.html.twig' %} #}

                <div class="card mb-3">
                    <div class="card-header d-flex justify-content-end">

                        <div class="d-flex" style="color: orange;">
                            {% set rating = quote.rating %}
                                    {# round(0,'floor') give the round number whith zero decimal so it give us the number of the full stars #}
                                    {% set biStarFill = rating|round(0, 'floor') %}
                                    {# if rating is a float between an integer+0.5 and the next integer "biStarHalf" #}
                                    {% set biStarHalf = rating - biStarFill >= 0.5 %}
                                    {% set biStar = 5 - biStarFill - (biStarHalf ? 1 : 0) %}
                                    {# {% dump(biStarFill)%}
                                    {% dump(biStarHalf)%}
                                    {% dump(biStar)%} #}
                                    {% for i in 1..5 %}
                                        {% if i <= biStarFill %}
                                            {{ '<i class="bi bi-star-fill"></i>' }}
                                        {% elseif i == biStarFill + 1 and biStarHalf %}
                                            {{ '<i class="bi bi-star-half"></i>' }}
                                        {% else %}
                                            {{ '<i class="bi bi-star"></i>' }}
                                        {% endif %}
                                    {% endfor %}
                            <span class="ps-1">{{ quote.rating|round(1, 'floor')  }}</span>
    
                        </div>

                    </div>

                    <div class="card-body">
                    
                        <blockquote class="blockquote mb-0">
                            <p>"{{ quote.text }}"</p> 
                                <div>
                                
                                    {# We check if the user is connected, because if not, he can't put quotes in favorite #}
                                    {% if is_granted("ROLE_USER") %}
                                                    {% set isFavorite = false %}
                                        {% for userFav in quote.users %}
                                                {% if currentUser.getUser == userFav %}
                                                    {% set isFavorite = true %}
                                                {% endif %}
                                        {% endfor %}
                                        
                                        {% if isFavorite %}
                                        <a href="{{ path('user_remove_favorite_quote', {quoteId: quote.id}) }}"  class="bi bi-bookmark-heart-fill fs-1 d-flex justify-content-end"></a>
                                        {% else %}
                                        <a href="{{ path('user_add_favorite_quote', {quoteId: quote.id}) }}" class="bi bi-bookmark-heart fs-1 d-flex justify-content-end"></a>
                                        {% endif %}

                                    
                                    {% endif %}
                                </div>
                            
                            <footer class="blockquote-footer"> {{ quote.name }},<cite title="Source Title"> <strong>{{ quote.season }}</strong>, {{ quote.title }}.</cite></footer>
                            <a href="{{ path('user_add_rating_quote', {quoteId: quote.id})}}" class="btn btn-outline-secondary d-flex justify-content-end">Donner une Note à la Citation</a>
                        </blockquote>
                    </div>
                </div>

                {% endfor %}

            </div>
            {{ knp_pagination_render(pagination) }}

        </div>

    </div>
   
</main>

{% endblock %}